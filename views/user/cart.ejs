<div class="ads-grid_shop">
    <div class="shop_inner_inf">
        <div class="privacy about">
            <h3>Chec<span>kout</span></h3>


            <% if(cart?.products?.length===0 || cart===null){ %>

                <div class="checkout-right" style="height: 1vh;">cart is empty</div>
                <% } else { %>
            <div class="checkout-right">
                <h4>Your shopping cart contains: <span>3 Products</span></h4>
                <table class="timetable_sub">
                    <thead>
                        <tr>
                            <th>SL No.</th>
                            <th>Product</th>
                            <th>Quantity</th>
                            <th>Product Name</th>

                            <th>Price</th>
                            <th>Total Price</th>
                            <th>Remove</th>
                        </tr>
                    </thead>
                    <% let totalPriceSum=0 %>
                    <% let priceAfterCoupon=0 %>


                    <tbody>

                        <% cart?.products?.forEach((item)=>{ %>

                        <% let totalprice=item?.product?.price*item?.quantity %>
                        <tr class="rem1 incrementdecrement" data-id="<%= item?.product?._id -%>">
                            <td class="invert">1</td>
                            <td class="invert-image">
                                <div style="width: 100px;">
                                <img src="/images/uploads/<%=item?.product?.images[0]-%>" alt=" " class="img-responsive w-fit" style="margin-left:120px ;margin-top: 20px;" />
                                </div>
                            </td>
                            <td class="invert ">
                                
                                <div class="quantity" >

                                    
                                    <div class="quantity-select " style="position: relative;bottom: 40px;" >
                                        <div class="entry value-minus dec-btn" id="">&nbsp;</div>
                                        <div class="entry value " id=""><span class="inputQuantity"><%= item?.quantity -%></span></div>
                                        <div class="entry value-plus active inc-btn" id="inc-btn">&nbsp;</div>
                                    </div>
                                </div>
                            </td>
                            <td class="invert" style="height: fit-content;">
                                <div class="rem" style="margin-right: 100px;height: fit-content;position: relative;bottom: 50px;">
                                    <div>  <%= item?.product?.productname -%></div>
                                </div>
                               
                            </td>

                            <td class="invert">
                                <div class="rem" style="margin-bottom: 40px;margin-right: 100px;">
                                    <div class="close1"><div class="price"> <%= item?.product?.price -%></div></button></div>
                                </div>
                            </td>
                            <td class="invert">
                                <div class="rem" style="margin-bottom: 40px;margin-right: 100px;">
                                    <div class="close1"><div class="total-price"> <%= item?.product?.price*item?.quantity -%></div></button></div>
                                </div>
                            </td>
                            <td class="invert">
                                <div class="rem" style="margin-bottom: 40px;margin-right: 100px;">
                                    <div class="close1"><button
                                        
                                        id="delete-btn"
                                         style="background-color: red;color: white;">Delete</button></div>
                                </div>

                            </td>
                        </tr>

                        <%  }) %>

                    </tbody>
                </table>
            </div>


            <div class="checkout-left">
                <div class="col-md-4 checkout-left-basket">
                    <h4>Continue to basket</h4>
                    <ul>
                        <li>Product1 <i>-</i> <span>$675.00 </span></li>
                        <li>Product2 <i>-</i> <span>$325.00 </span></li>
                        <li>Product3 <i>-</i> <span>$405.00 </span></li>
                        <li>Total Service Charges <i>-</i> <span>$55.00</span></li>
                        <% console.log('cart') %>
                        <% console.log(cart.products) %>
                        <li>Total <i>-</i> <span class="total-price-sum">
                            <%= cart?.products?.map(el=>el?.product?.price*el?.quantity).reduce((total,el)=>total+el,0) %>
                        </span></li>
                    </ul>
                </div>
                <div class="col-md-8 address_form">
                    <h4>Add a new Details</h4>
                    <form action="payment.html" method="post" class="creditly-card-form agileinfo_form">
                        <section class="creditly-wrapper wrapper">
                            <div class="information-wrapper">
                                <div class="first-row form-group">
                                    <div class="controls">
                                        <label class="control-label">Full name: </label>
                                        <input class="billing-address-name form-control" type="text" name="name" placeholder="Full name">
                                    </div>
                                    <div class="card_number_grids">
                                        <div class="card_number_grid_left">
                                            <div class="controls">
                                                <label class="control-label">Mobile number:</label>
                                                <input class="form-control" type="text" placeholder="Mobile number">
                                            </div>
                                        </div>
                                        <div class="card_number_grid_right">
                                            <div class="controls">
                                                <label class="control-label">Landmark: </label>
                                                <input class="form-control" type="text" placeholder="Landmark">
                                            </div>
                                        </div>
                                        <div class="clear"> </div>
                                    </div>
                                    <div class="controls">
                                        <label class="control-label">Town/City: </label>
                                        <input class="form-control" type="text" placeholder="Town/City">
                                    </div>
                                    <div class="controls">
                                        <label class="control-label">Address type: </label>
                                        <select class="form-control option-w3ls">
                                                                                        <option>Office</option>
                                                                                        <option>Home</option>
                                                                                        <option>Commercial</option>
                        
                                                                                </select>
                                    </div>
                                </div>
                                <button class="submit check_out">Delivery to this Address</button>
                            </div>
                        </section>
                    </form>
                    <div class="checkout-right-basket">
                        <a href="/payment">Make a Payment </a>
                    </div>
                </div>

                <div class="clearfix"> </div>


                <div class="clearfix"></div>
            </div>
            <% } %>
        </div>
    </div>
  
    <div class="mid_slider_w3lsagile">
        <div class="col-md-3 mid_slider_text">
            <h5>Some More Shoes</h5>
        </div>
        <div class="col-md-9 mid_slider_info">
            <div id="myCarousel" class="carousel slide" data-ride="carousel">
            
                <ol class="carousel-indicators">
                    <li data-target="#myCarousel" data-slide-to="0" class=""></li>
                    <li data-target="#myCarousel" data-slide-to="1" class="active"></li>
                    <li data-target="#myCarousel" data-slide-to="2" class=""></li>
                    <li data-target="#myCarousel" data-slide-to="3" class=""></li>
                </ol>
                <div class="carousel-inner" role="listbox">
                    <div class="item">
                        <div class="row">
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g1.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g2.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g3.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g4.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="item active">
                        <div class="row">
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g5.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g6.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g2.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g1.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="row">
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g1.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g2.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g3.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g4.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="row">
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g1.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g2.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g3.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                            <div class="col-md-3 col-sm-3 col-xs-3 slidering">
                                <div class="thumbnail"><img src="images/g4.jpg" alt="Image" style="max-width:100%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
        <span class="fa fa-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
                <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
        <span class="fa fa-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
              

            </div>
        </div>

        <div class="clearfix"> </div>
    </div>
  
    <div class="newsletter_w3layouts_agile">
        <div class="col-sm-6 newsleft">
            <h3>Sign up for Newsletter !</h3>
        </div>
        <div class="col-sm-6 newsright">
            <form action="#" method="post">
                <input type="email" placeholder="Enter your email..." name="email" required="">
                <input type="submit" value="Submit">
            </form>
        </div>

        <div class="clearfix"></div>
    </div>

</div>


<div class="modal" id="addToCartModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          Product added to cart!
        </div>
      </div>
    </div>
  </div>


 <style>



.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 9999;
}

.modal-dialog {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  padding: 20px;
  border-radius: 4px;
}

</style>

<script>


    const decBtn = document.querySelector("#dec-btn")
    const incBtn = document.querySelector("#inc-btn")
      incBtn.addEventListener("click", () => {
        if (displayCount.innerText < 10) displayCount.innerText++
        else showToast("Maximum 10 quantities are allowed")
    })

    decBtn.addEventListener("click", () => {
        if (displayCount.innerText > 1) displayCount.innerText--
    })

</script> 


<script>
  
    function proceedToCheckout() {
      const couponId = document.querySelector("#coupon").getAttribute("data-coupon");
      
      if (couponId && couponId !== "") {
        window.location.href = `/checkout/${couponId}`;
      } else {
        window.location.href = "/checkout";
      }
    }
  
  </script>



<script>
    
  
    const displayCount = document.querySelectorAll(".incrementdecrement");
    const totalpricesum = document.querySelector('.total-price-sum');
    const priceaftercoupon = document.querySelector('.price-after-coupon');
    const deleteBtn=document.getElementById('delete-btn')

    
    console.log(displayCount)
    displayCount.forEach(item=>{
    const decBtn = item.querySelector(".dec-btn")
    const incBtn = item.querySelector(".inc-btn")
    const inputQuantity = item.querySelector(".inputQuantity")
    const price = item.querySelector('.price')
    const totalprice=item.querySelector('.total-price')
    const productId = item.getAttribute("data-id")
    

    incBtn.addEventListener("click", () => {
      
      let qty=Number(inputQuantity.textContent)

      if (qty < 10) {
        inputQuantity.textContent=++qty
        totalprice.textContent=price.textContent*qty
        updatetotalpricesum()
        updateQuantity(productId,qty)
      }
        
    })

    decBtn.addEventListener("click", () => {
      let qty=inputQuantity.textContent 
      if (qty > 1) {inputQuantity.textContent=--qty
      totalprice.textContent=price.textContent*qty
      updatetotalpricesum()
      updateQuantity(productId,qty)
     
    }
    })


    })
     
    function updatetotalpricesum(){
      let sum=0
      displayCount.forEach(item=>{
      const totalprice=item.querySelector('.total-price')
      console.log(totalprice.textContent)
      sum+=Number(totalprice.textContent)
      })
      totalpricesum.textContent=sum
   
    }
  function updateQuantity(productId,quantity){
    fetch("/update-cart", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ productId,quantity }),
    })
      .then((response) => response.json())
      .then((data) => {
             
      })
      .catch((error) => console.error(error));
  }

  const applycoupon=document.querySelector('.applycoupon')
  applycoupon.addEventListener('click',e =>{
    e.preventDefault();
    window.location.href=`/addcoupon?total=${totalpricesum.textContent}`
  })

  
    
    deleteBtn.addEventListener('click',()=>{
        let qty=Number(inputQuantity.textContent)
        fetch('/remove-from-cart',{
            method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ productId,quantity }),   
        })
    })
    .then((response) => response.json())
    .then((data) => {
             
      })
    .catch((error) => console.error(error));

  

 
 </script>